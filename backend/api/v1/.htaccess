# GTV Motor API v1 - Apache Configuration
# For api.gtvmotor.dev/api/v1/

RewriteEngine On
RewriteBase /api/v1/

# Block direct access to root endpoint - redirect to documentation
RewriteCond %{REQUEST_URI} ^/api/v1/?$
RewriteRule ^(.*)$ /api/v1/docs/ [R=301,L]

# Allow direct access to docs directory and files
RewriteCond %{REQUEST_URI} ^/api/v1/docs
RewriteCond %{REQUEST_FILENAME} -f
RewriteRule ^ - [L]

# Serve index.html for docs directory
RewriteCond %{REQUEST_URI} ^/api/v1/docs/?$
RewriteRule ^docs/?$ docs/index.html [L]

# Handle OPTIONS requests for CORS
RewriteCond %{REQUEST_METHOD} OPTIONS
RewriteRule ^(.*)$ index.php [QSA,L]

# Route all other requests to index.php
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteRule ^(.*)$ index.php [QSA,L]

# Security headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "DENY"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Disable directory listing
Options -Indexes

# Protect sensitive files
<FilesMatch "\.(env|log|ini|conf)$">
    Order allow,deny
    Deny from all
</FilesMatch>

